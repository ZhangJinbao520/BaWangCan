# -*- coding: utf-8 -*-
# 
# 第八套中小学生广播体操，现在开始...
# 第一节，_φ(❐_❐✧ 人丑就要多读书
# ┏(＾0＾)┛  ┏(´0｀)┛  ┏(´0｀)┛  ┏(´0｀)┛
# ┗(＾0＾)┏  ┗(｀0´)┏  ┗(｀0´)┏  ┗(｀0´)┏
# ┏(´0｀)┏   ┏(´0｀)┏  ┗(｀0´)┛  ┗(｀0´)┛
# _(:ι」∠)_好饿，但是不想动
# 睡觉没前途(￣o￣) . z Z　
#
# Created by: PyQt5 UI code generator 5.15.2
# Created by: Python 3.8
#
# WARNING: Do not edit this file unless you know what you are doing.
# See https://github.com/zhangjinbao520/BaWangCan
# 
# __author__ = "ZhangJinbao"
# Copyright(C) 2021 ZhangJinbao All rights reserved.
# 
# 作用：
#    1、二维码登录界面
#    2、霸王餐（免费试）运行界面

from PyQt5 import QtCore, QtGui, QtWidgets, Qt
from area import dictProvince, dictCity
from config import Config
from backendThread import linkStatusThread, runStatusThread, runResultThread
import requests, time, re, base64, sys

class Ui_Login(QtWidgets.QWidget):
    '''
    登录界面(二维码)
    '''
    def __init__(self):
        super().__init__()
        self.setupUi()

    def setupUi(self):
        # 窗口定义
        self.setFixedSize(290, 358)
        self.setWindowFlags(QtCore.Qt.WindowCloseButtonHint)    # 只保留关闭按钮
        self.setStyleSheet("background-color: rgba(255, 255, 255, 255);border-width:0;border-style:outset;")
        # 应用图标
        ico = 'https://www.dpfile.com/app/pc-common/dp_favicon.a4af753914321c8e82e402e2b4be01d7.ico'
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap(self.getImgFromInternet(ico)['img']), QtGui.QIcon.Normal, QtGui.QIcon.Off)
        self.setWindowIcon(icon)
        # QRCode
        self.iconQRCode = QtWidgets.QLabel(self)
        self.iconQRCode.setGeometry(QtCore.QRect(65, 75, 160, 160))
        self.iconQRCode.setScaledContents(True)
        self.setQRCodeFromImg()
        # icon-scan
        src = 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGwAAABjCAMAAABJ7hUqAAAAkFBMVEUAAAD/ZTL/ZDH/ZTT/XzD/ZjL/ZTP/ZjP/ZTP/ZzP/ZTL/aD//ZzP/ZDH/YC3/ZzP/aiv/ZjP/ZjL/ZTL/aDP/ZzT/ZjL/ZjL/ZDH/ZDL/ZDL/ZTL/ZjP/ZTP/ZjL/ZjL/ZjP/ZTL/ZjP/ZjL/ZTL/ZDH/ZjH/ZDP/ZDD/ZjP/ZTL/ZTL/ZDD/ZC7/ZjP/aDT9p+krAAAALnRSTlMA0VRTDQrA08/6QAPxHhLmBfablP3txndiS0Ym2cqvcL2nhX5nXFcrOeK1iiMxq6ndNAAAAeVJREFUaN7t2ltv4jAQBeBjGghxQrgn3Eq50227nv//71aIZNMqdqgEnod2vsdI9sEyeZjo4JNAv2eqW6M2czR6Xauulcp2ug2bNA8NkbGgaBfDbTYk40BkVJ6iZhGSe81kAadzQqYBUVfbfp4bjeH0QqYZJUd88RQ1LqERnPZkbqDhl0v/6DevoBmc9MTcQn96qIz+Z5HVWxtO8YicbNewTKg88EqFNdk+QIPBSye0Uquo3Hfaq91xND6nQd0ANwwCu/Q8mtTuYX0No3c83LjYeotC/EzlNT5cr3/d+znGVVtdH3TweIPiIKrNEIYNZ1hHwiRMwiRMwiTsJ4aF/sPCMiwuHmzhwbY4SIzCkegyGGl4sIgue09OKMX5lKh/gBeHPtE0j1FZnlo9eNJrnZYQQoj7pbr15F1LB5es+SoiBlG4AF4TMixo+hcdMkzoDYbPkPNka9Y74/w3Fu8ZAx1ACCHuwD/FDPaX+WyGkpf5jG/ypCM4Zup1OVNzfi34BR9dJEzCJEzCJEzC/IZt4MHGEZah4qlbULUm+gytCaY+SL3psvTVdDnYOzw13+nwKKvVsNw3+eBvJ/H3rjBnaJRVZglHV66kuwwtwPv7jYekqd8Y5ilsAr3LVN03mpuhsst2OkDlH1u1nVI15N1TAAAAAElFTkSuQmCC)'
        self.iconScan = QtWidgets.QLabel(self)
        self.iconScan.setGeometry(QtCore.QRect(65, 265, 35, 35))
        self.iconScan.setPixmap(QtGui.QPixmap(self.getImgFromBase64(src)))
        self.iconScan.setScaledContents(True)
        # icon-Mobile
        src = 'url(data:image/png;base64,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)'
        self.iconMobile = QtWidgets.QLabel(self)
        self.iconMobile.setGeometry(QtCore.QRect(90, 75, 110, 170))
        self.iconMobile.setPixmap(QtGui.QPixmap(self.getImgFromBase64(src)))
        self.iconMobile.setScaledContents(True)
        # "打开大众点评，扫描二维码登录"
        self.content = QtWidgets.QTextBrowser(self)
        self.content.setGeometry(QtCore.QRect(105, 260, 140, 50))
        # "二维码超时"
        self.contentQRCodeInvalid = QtWidgets.QTextBrowser(self)
        self.contentQRCodeInvalid.setGeometry(QtCore.QRect(65, 75, 160, 160))
        self.contentQRCodeInvalid.setStyleSheet("background-color: rgba(255, 255, 255, 230);")
        # "APP扫码，享七天免登录"
        self.contentSubtitle = QtWidgets.QTextBrowser(self)
        self.contentSubtitle.setGeometry(QtCore.QRect(22, 30, 246, 30))
        # "扫描成功！请在手机上确认登录"
        self.contentSuccess = QtWidgets.QTextBrowser(self)
        self.contentSuccess.setGeometry(QtCore.QRect(10, 260, 270, 50))
        # 请点击刷新
        self.btnRefresh = QtWidgets.QPushButton(self)
        self.btnRefresh.setGeometry(QtCore.QRect(97, 158, 96, 34))
        self.btnRefresh.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))    # 设置鼠标手势
        self.btnRefresh.setStyleSheet("font: 12pt bold;color: rgb(255, 255, 255);background-color: rgba(255, 102, 51, 240);")
        self.btnRefresh.setObjectName("btnRefresh")
        # 信号关联槽位
        QtCore.QMetaObject.connectSlotsByName(self)    # 自动连接槽，使得装饰器@QtCore.pyqtSlot可生效
        self.backend = linkStatusThread(self.QRCode['lgtoken'])    # 创建线程
        self.backend.linkStatus.connect(self.queryQRCodeStatus)   # 连接信号
        self.backend.start()    # 开始线程
        # Ui初始化
        self.retranslateUi()
        self.contentQRCodeInvalid.raise_()
        self.btnRefresh.raise_()
        self.iconMobile.hide()
        self.contentQRCodeInvalid.hide()
        self.btnRefresh.hide()
        self.contentSuccess.hide()
        self.show()

    def setQRCodeFromImg(self):
        self.QRCode = self.getImgFromInternet('https://account.dianping.com/account/getqrcodeimg')
        self.iconQRCode.setPixmap(QtGui.QPixmap(self.QRCode['img']))

    @QtCore.pyqtSlot()
    def on_btnRefresh_clicked(self):
        self.setQRCodeFromImg()
        self.contentQRCodeInvalid.hide()
        self.btnRefresh.hide()
        # self.backend.lgtoken = self.QRCode['lgtoken']???
        self.backend.start(self.QRCode['lgtoken'])

    def queryQRCodeStatus(self, status):
        '''
        QRCode登录状态
        信号定义：
              -1  ：连接超时
               0  ：连接中...
               1  ：扫描成功
               2  ：确认登录
               3  ：取消登录
            Other ：连接异常
        '''
        if status == 0:
            # 连接中...
            pass
        elif status == 1:
            # 扫描成功
            self.iconQRCode.hide()
            self.iconScan.hide()
            self.content.hide()
            self.iconMobile.show()
            self.contentSuccess.show()
        elif status == 2:
            # 确认登录
            self.backend.terminate()    # 终止线程
            self.close()
            TrayIcon(self.Cookie)
        else:
            # 连接超时、或用户取消登录、或异常
            if status == 3:
                # 用户取消登录
                self.iconMobile.hide()
                self.contentSuccess.hide()
                self.iconQRCode.show()
                self.iconScan.show()
                self.content.show()
            self.contentQRCodeInvalid.show()
            self.btnRefresh.show()
            self.backend.terminate()    # 终止线程

    def retranslateUi(self):
        '''
        文字以及文字编码
        '''
        _translate = QtCore.QCoreApplication.translate
        self.setWindowTitle(_translate("Login", "大众点评"))
        self.content.setHtml(_translate("Login", 
        "<span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:11pt; color:#999999;\">打开</span>"
        "<span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:11pt; color:#ff6633;\">大众点评APP</span>\n"
        "<span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:11pt; color:#999999;\">扫描二维码登录</span>"))
        self.contentQRCodeInvalid.setHtml(_translate("Login", 
        "<br><br><br>"
        "<p align=\"center\"><span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:12pt; font-weight:600; color:#333333;\">二维码已失效</span></p>"))
        self.contentSubtitle.setHtml(_translate("Login", 
        "<p align=\"center\"><span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:14px; color:#999999;\">APP扫码，享七天免登录</span></p>"))
        self.btnRefresh.setText(_translate("Login", "请点击刷新"))
        self.contentSuccess.setHtml(_translate("Login",
        "<p align=\"center\" style=\" margin-top:0px; margin-bottom:2px;\"><span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:16px; color:#111111;\">扫描成功！</span></p>"
        "<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px;\"><span style=\" font-family:\'Tahoma\',\'sans-serif\'; font-size:13px; color:#111111;\">请在手机上确认登录</span></p>"))

    @staticmethod
    def getImgFromBase64(src):
        '''
        加载base64图片
        '''
        return QtGui.QImage.fromData(base64.urlsafe_b64decode(src.split(',')[1]))    # 返回bytes类型

    @staticmethod
    def getImgFromInternet(url):
        '''
        加载网络图片
        return:
            img    ：图片（bytes类型）
            lgtoken：用于查询二维码登录状态，一个二维码对应一个lgtoken
        '''
        headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36'}
        response = requests.get(url=url, headers=headers)
        img = QtGui.QImage.fromData(response.content)    # 返回bytes类型
        try:
            # 返回lgtoken，用于queryQRCodeStatus(一个QRCode对应一个lgtoken)
            lgtoken = re.search(r'lgtoken=(.*); Domain(.*)', response.headers['set-Cookie'])[1]
        except:
            lgtoken = None
        return {'img': img, 'lgtoken': lgtoken}

class Ui_Run(QtWidgets.QWidget):
    '''
    主界面
    '''
    def __init__(self, cookie, province=None, city=None):
        super().__init__()
        self.Cookie = cookie
        self.Province = province
        self.City = city
        self.getUserinfo()

    def setupUi(self):
        # 窗口定义
        self.setFixedSize(480, 207)
        self.Run = QtWidgets.QWidget(self)
        self.Run.setGeometry(QtCore.QRect(0, 0, 480, 207))
        self.Run.setStyleSheet("background-color: rgba(255, 255, 255, 255);border-width:0;border-style:outset;")
        # 应用图标
        ico = 'https://www.dpfile.com/app/pc-common/dp_favicon.a4af753914321c8e82e402e2b4be01d7.ico'
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap(Ui_Login.getImgFromInternet(ico)['img']), QtGui.QIcon.Normal, QtGui.QIcon.Off)
        self.setWindowIcon(icon)
        # "省份"下拉列表
        self.boxProvince = QtWidgets.QComboBox(self.Run)
        self.boxProvince.setGeometry(QtCore.QRect(360, 10, 112, 25))
        self.boxProvince.setStyleSheet('font: 11pt "华文楷体";border: 1px solid rgb(171, 171, 171);border-radius: 2px;')
        self.boxProvince.setObjectName("boxProvince")
        if self.Province:
            self.boxProvince.addItem(self.Province)
        else:
            self.boxProvince.addItem('请选择')
        for key, value in dictProvince.items():
            if key == self.Province:
                pass
            else:
                self.boxProvince.addItem(key)    # 参数：text、index
        # "城市"下拉列表
        self.boxCity = QtWidgets.QComboBox(self.Run)
        self.boxCity.setGeometry(QtCore.QRect(360, 55, 112, 25))
        self.boxCity.setStyleSheet('font: 11pt "华文楷体";border: 1px solid rgb(171, 171, 171);border-radius: 2px;')
        if self.City:
            self.boxCity.addItem(self.City)
            for key, value in dictCity[self.boxProvince.currentText()].items():
                if key == self.City:
                    pass
                else:
                    self.boxCity.addItem(key)    # text，index
        else:
            self.boxCity.addItem('请选择')
        # "开始执行"
        self.btnRun = QtWidgets.QPushButton(self.Run)
        self.btnRun.setGeometry(QtCore.QRect(300, 120, 120, 45))
        self.btnRun.setStyleSheet('font: 16pt bold;background-color: rgba(240, 240, 240, 250);border: 1px solid rgb(160, 160, 160);border-radius: 6px;')
        self.btnRun.setObjectName("btnRun")
        # "头像"
        self.iconUser = QtWidgets.QLabel(self.Run)
        self.iconUser.setScaledContents(True)
        self.setImgCycle(self.userFace)
        # 账户等级
        self.iconLevel = QtWidgets.QLabel(self.Run)
        self.iconLevel.setGeometry(QtCore.QRect(150, 110, 35, 15))
        self.iconLevel.setPixmap(QtGui.QPixmap(Ui_Login.getImgFromBase64(self.userLevel)))
        self.iconLevel.setScaledContents(True)
        # 收藏&团购券
        self.contentOpt = QtWidgets.QTextBrowser(self.Run)
        self.contentOpt.setGeometry(QtCore.QRect(0, 163, 240, 55))
        self.contentOpt.setVerticalScrollBarPolicy(QtCore.Qt.ScrollBarAlwaysOff)
        # 注册时间
        self.contentUseday = QtWidgets.QTextBrowser(self.Run)
        self.contentUseday.setGeometry(QtCore.QRect(0, 134, 240, 25))
        self.contentUseday.setVerticalScrollBarPolicy(QtCore.Qt.ScrollBarAlwaysOff)
        # 昵称
        self.contentUser = QtWidgets.QTextBrowser(self.Run)
        self.contentUser.setGeometry(QtCore.QRect(0, 105, 150, 25))
        self.contentUser.setVerticalScrollBarPolicy(QtCore.Qt.ScrollBarAlwaysOff)
        # "请选择省份"
        self.contentProvince = QtWidgets.QTextBrowser(self.Run)
        self.contentProvince.setGeometry(QtCore.QRect(240, 12, 120, 25))
        # "请选择城市"
        self.contentCity = QtWidgets.QTextBrowser(self.Run)
        self.contentCity.setGeometry(QtCore.QRect(240, 57, 120, 25))
        # 信号关联槽位
        QtCore.QMetaObject.connectSlotsByName(self)    # 自动连接槽，使得装饰器@QtCore.pyqtSlot可生效
        self.backendStatus = runStatusThread()    # 创建线程_1
        self.backendStatus.runStatus.connect(self.on_btnRun_refreshed)   # 连接信号
        self.backendResult = runResultThread(self.Cookie, self.userNickName)    # 创建线程_2
        self.backendResult.runResult.connect(self.on_btnRun_finished)
        # Ui初始化
        self.retranslateUi()
        self.show()

    def getUserinfo(self):
        '''
        获取个人信息
        '''
        url = 'http://www.dianping.com/ajax/userinfo'    # 获取个人信息的URL
        headers = {
            'cookie': self.Cookie,
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36'
        }
        response = requests.get(url=url, headers=headers)
        if response.status_code == 200:
            msg = response.json()['msg']
            if msg['isLogined']:
                self.favorShopCount = msg['favorShopCount']
                self.dealCount = msg['dealCount']
                userInfo = msg['userInfo']
                self.userFace = userInfo['userFace']
                self.userNickName = userInfo['userNickName']
                self.useDpDays = userInfo['useDpDays']
                imgLevel = userInfo['userLevel']
                if imgLevel == 1:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAAAaVBMVEUAAAD6vAD6vAD6vAD6vAD6vAD////wthn1uQ75uwPytxT3ugj43I7//fnzxkzzuBH99d3ywDfxvCnxuSD++/H++e3878z76br65rH32IX20W7zw0H++On88dP54qL43ZT21Hj1zWLxvTCAfaO6AAAABXRSTlMA50pJ5HISpQsAAADTSURBVDjLzdTbCsIwDAZg3Uyatlt33tw8+/4PaVMZOhhCKoL/RQmED9oUsnlPugVRtumCs5b5BQdxfsFJ+RCsRRO3PnOFPmqVU8atOK6pcHk01/U4sI7lFSJKuDXzEEkpY3lsEm56rg4arEPsDbck3E5cZQTFHvFmpRyao69Ko6scSwViTlm4PV0QryTn+p7z7esWuwbkPDway5EHEMOt47rFvNYxHMwJOWcCIX/GTIFXWsbnqKbz51BAJA9/56yAk3qF5gWxukn+aNd9uagTod8lDz4xHpLnGpMLAAAAAElFTkSuQmCC'
                elif imgLevel == 2:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAAAhFBMVEUAAAD6vAD6vAD6vAD6vAD6vAD6vAD////wthn0uA73ugb2uQzytxXzuBH//vv++/L99d/++On657H43I7+/Pb31n/21HX20W3zw0LxvS7xuR/++u743pb1zF7zxkzzxkrxvCj878z1zWL0ylbywDnyvzX88dP66Lj55Kn54qL32YnutB9S+4deAAAABnRSTlMA5udKSeR5S5ZUAAABIElEQVQ4y82U2W7DIBBF6yTlegDjJd6X2Nm6/v//1UAl12pVgaVKPW8MOtLMHcTDVw4B8yI4rHRt+/krnXnzBzqFM7RZDzETsp8gGcqIb9RF0yd5mo20SRd1Co2qxBa9TfByLTsgnpx0Lk2INk0ZFeiJiwHAhbvo8oyZmjN+As7vCRp9GwOVk84rzBwFizLgEknTiEyBu9vsrc4qkeyukHyGwW9AFrnp4mi6px4obdq6kbThjsk3Snc/xehae0cl8lE47t0MjaQwAWjEVamBmKNuIgdi5JO1xxglebx5+QTNq3GojlEQc9It0uxO3bi2hxxvtky/6gth2wF4jrRdqKXsqpvdnbgtO+kULpA50fey5R/9dYGvvVvp+52f/bj/ALruJ6T7mAAKAAAAAElFTkSuQmCC'
                elif imgLevel == 3:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAAAgVBMVEUAAAD6vAD6vAD6vAD////wthn5uwP0uA/2uQz//vvytxT2ugnzuBHxuSL3ugf878310Gn+/Pf++/P++ev424zywTvxvCnwuBz768H20m/zxkvzxEP99d388dT657L546X43JD21HfyvjD3ugn65az43pb314H1zF/yvzT77sj66Ligz5uWAAAAA3RSTlMA5kn9UmmAAAABNUlEQVQ4y7WV6W6DMAyA18a5ucvVAm2BXtv7P+DsTF1XaRKBqt8PZJA+4tjBfPxlvWKzWK2fdLRn+k86m807dMkRuVjngHD2D9ZwbsaFuuDbOM0+EykW6fwAjrNcotstxE2Jr9CD8NKtuRdR4p6Dvg6tCDVA4aebmKJGsGgHEBsbRIz0OvBKntJFcsWCPcDVYvFGmUNXRp57rzYYtUbcNLQV2kVyAqhvylNXR5e9OgP06NgEiM0Q+eli0JR9mcEmpNsmP57wyT7w092mob24ApCvlMQMUu6nU8mRDNLy96RVqb/OTAfEQbq1R9Kpc9P6D8b1TtNBUcUlCbnpQe8mSveAh9S7r4AeY6R1p7OrZN66651bTiVxhnFcqKlx8UAKSdf7116VobEvDCvxnlm3fFAv/018AwIOG3Z8tcYYAAAAAElFTkSuQmCC'
                elif imgLevel == 4:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAAAZlBMVEUAAAD6vAD6vAD6vAD6vAD////wthn0uA/2uQz4uwXytxT2ugn//vrzxkzyvS3xuR/878z43I754qT21HT++Oj99d3++/H++e365rH20W7zw0HywDb++On88dP66Lj43pb314L1zWL8HavtAAAABHRSTlMA5kpJG2qUMwAAAO9JREFUOMvN1NuOgjAUBdBBz6U3WgTRcZzr///k9JSHyoNJD8bE/UAKYSXtbtq32+w7UKXbr7honV9xUOcJnCmHN3PCHLonmIi3c54QaTM3fXiA+3jEZu5dKXFZsPMANg3Yzl35+cOC7REHB8AjKri/yOhggN8R/3ypbWznkD7zaHb2GnCmUtuQFNwcyuzND+JkpLZjJAW3Mcjs4wnPSWoLvdHwsmicf6UAqW0iKpy4iUvlOScMUb7WUBsH94WSkbV8ibug5GqXc9g2+RpK5/z8rmesVtfEy971XsGZatjy+u5Yv77QXffgRb3rlHr3D63/GoRVxet0AAAAAElFTkSuQmCC'
                elif imgLevel == 5:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAAAh1BMVEUAAAD6vAD6vAD6vAD6vAD6vAD////wthn0uA/4uwT3ugj2uQzytxT//vryvS754Z743I/xuSH657P1zV/99d3xuibwtx3++e399+b88tX88M3435n20W/zxkzzw0DywDf++/H77cb768D546j32Yb314H55Kr21Xr21Hj1zmX0yljzx03xthVj6N53AAAABXRSTlMA5udKSZhEgMsAAAEkSURBVDjLzZTZboMwEEVLEl+PFyDsYcme7v3/7+uYClGkSjFUlXrekDiaewfsh+9sAjGLYDPR2Z7pT3Qxmz/QSTK0WJdgpPgJkj20TDcZeuQiXRW73+gU4zojvLbDu9zZavMOpM8RKc/V2QbMQQm9Bxpb1mDCNtF+uu7AbI2gFMjo7ZKHYJpC+XUv3apyq44h8pK72CQ7A7iSn262fXrTAi9GOLS8cf5IeekqCl364oQqGQbaCxfRXnpfGvmjW8CgG3569dPdypnTEHcodPQJ77A1HDFxE0pKo3SyQ+qxui8+OjjcOIpR3aLDGXWk7+kDMqkAN67XHWFcGOGt999u78YpmbVPcXf3pyU5QorGI6KJSLM88o/uumCuvZro69U8O1h/AvtrIx4xf1VUAAAAAElFTkSuQmCC'
                elif imgLevel == 6:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAAAflBMVEUAAAD6vAD6vAD6vAD6vAD////wthn0uA/3ugn2uQz4uwXwtxzztxP//vvxvCz++vDyvzPytxX++Oj43ZP657Hzxkzzw0D88tP878v65Kn43I731Xr1zWDxuiT+/Pf99uH768D66Lf54qH54Jr32IP20W70yVPywDj99Nz203PmtLLWAAAABHRSTlMA5kpJG2qUMwAAAT1JREFUOMu1lMlywjAQRENQe0aLF3kHzE5Y/v8HI4kD4RAiO0VXSbdXM91dNR8/NZ+JUZrNn3BHj+SfcDFab8ApcaLJeAKn5DdCMRk5FWdT3A67lZyEK2p2SBdDNmk66yOwK4jjvLMNId7TtKz0Hqg1x0Znezi1SnAD9JYqoNMqOnn+gtNSClMDA7UpcC7ateHI4nQJ4GpVkWKraQGkpXv7IrI4uQzbywpYSZ0D5Wno3F+oKFxlqd9+nSNfqwuAk+RsA9QUhQfTuJ58AKoBcGMRPOg4nD2DHJtMqBbeguAVgCwOF7aD18Ft671XMtSR/z39Lhu6Sy8uKzoAvRE+x+Nr7w8lLjZgb0KOJXA27t9mKhb3w9BwqPHSYVNv0b/unZKHSNHjdrAejovqbHjqsWIiye+4df8/1J+zkfTnN79iIPr6k2tiAAAAAElFTkSuQmCC'
                elif imgLevel == 7:
                    self.userLevel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAaCAMAAADYIh9WAAABOFBMVEUAAAD/yVf/ZjP/ZjP/si3/rCT/ZjP/rCT/rCT/rCT/uDr/rCT/rCT/x1P/x1T/ZjP/xE7/xlH/rCT/w0z/rCT/rCT/rCT/rCT/wkv/rCT/rCT/rCT/vkP/rCT/rCT/xlL/wUn/ZjP/////zFz/rCT/6gD/28//cEH/zFv/4df/r5T/mXf/6+T/aDT/lHD/ajn//Pv/wEf/ryj/+PX/5t3/49r/qYz/oYL/nHv/hFv/fE//dkj/dzH/bjH/4Rv/8Ov/3dL/zb3/tp3/h17/zlj/ylj/z1T/x1P/wVH/fFH/xU//0kr/sUr/okL/vUH/uj3/1jz/uDn/tjX/gjT/cjT/3Cv/nSf/oyb/rSX/3iT/qST/4xX/5wr/6QT/8+//7+r/x7T/vqj/f1T/izf/qy3/hyz/jyr/lymUD5ALAAAAIXRSTlMA/uZJ/u3n38gYCPn18+jk1L+xm5Z4aVtXTkI3Ni0kIg/gNnfgAAABzUlEQVQ4y8XTZ1PCQBCA4SD23nvby0WimISmiCD23nvv7f//A3c3mAtmmAmffD/A7TDPzOYyaNxoRMc2ihv4GSlA2GqirCfbSJtFo2ji944V3jPv1KlLwzAu6XAAoSPdw/rEoE7oeFgNHzSJ7D8yf9ynxzgPzyf42rYeDLeHLbq+i7C8uZ20eW/8dl+6PiHEFARyYl7Mu3Tq1lDd8vVV4AvitznmjZLa01V7EruqwO1pKo0/zjBvapDYmY+f4Xy9pHgw6xl/3GWujdWR3/b0Nk53F6D4WxyjJ43F4zmg1nl3l2vDLQhOPX6KugA+nhPYPB7WhLCBWuPdmWMDyG8iJR25kfIcFMdW3KPzJDIWUBnenTnVh/64xI+l/IRyHhdYHrJCZHlexHEaFNd6pUxtst5MyS/4w51l2t7KiGWH53naXXGsW8oj5kfyG/ycm6Gz7ZkpHBfLeHOjTJmozdSVFeT5BF21SMd4iiV4dz+n159EnsQXHuTwIqhX4LK8u+LceF2tqZsfpIN8nXQiD9yq2l1xbaQ1qScL4EVglrPdd7cKnJPm3UtcNVSrv4OPey24/5QccDbtrriq/xCqTfMH/8prqtX1ZTxaX53uiP4Al/7RDyxDAioAAAAASUVORK5CYII='
                return True
        else:
            return False

    def setImgCycle(self, url):
        '''
        设置头像为圆形
        '''
        self.target = QtGui.QPixmap(QtCore.QSize(240, 100))
        self.target.fill(QtCore.Qt.transparent)
        img = QtGui.QPixmap(Ui_Login.getImgFromInternet(url)['img']).scaled(100, 100, QtCore.Qt.KeepAspectRatioByExpanding, QtCore.Qt.SmoothTransformation)
        # 绘制圆形
        path = QtGui.QPainterPath()
        path.addRoundedRect(70, 1, 100, 100, 50, 50)
        painter = QtGui.QPainter(self.target)
        painter.setRenderHints(QtGui.QPainter.Antialiasing | QtGui.QPainter.HighQualityAntialiasing | QtGui.QPainter.SmoothPixmapTransform)
        painter.setClipPath(path)
        # 绘图，裁剪，合并
        painter.drawPixmap(70, 1, img)
        self.iconUser.setPixmap(self.target)

    @QtCore.pyqtSlot(str)
    def on_boxProvince_activated(self, text):
        self.boxCity.clear()    # 清空列表
        if text != "请选择":
            for key, value in dictCity[text].items():
                self.boxCity.addItem(key)    # text，index
        else:
            self.boxCity.addItem("请选择")

    @QtCore.pyqtSlot()
    def on_btnRun_clicked(self):
        '''
        按钮点击事件
        '''
        if self.boxCity.currentText() != "请选择":
            self.backendStatus.currentText = self.btnRun.text()
            self.backendStatus.start()    # 开始线程_1
            self.backendResult.start()    # 开始线程_2
            # 保存'config.ini'
            Config().saveConfig('Province', 'Province', self.boxProvince.currentText())
            Config().saveConfig('City', 'City', self.boxCity.currentText())
    
    def on_btnRun_refreshed(self, text):
        '''
        按钮刷新事件
        '''
        self.btnRun.setText(text)
        self.backendStatus.currentText = self.btnRun.text()

    def on_btnRun_finished(self):
        '''
        按钮执行事件
        '''
        self.backendStatus.terminate()    # 结束线程_1
        self.backendResult.terminate()    # 结束线程_2
        self.btnRun.setText("Run")
        QtWidgets.QMessageBox.information(self, '提示', '执行已完成！')

    def retranslateUi(self):
        _translate = QtCore.QCoreApplication.translate
        localhour = int(time.strftime('%H'))
        if localhour >=6 and localhour <12:
            hello = "上午好， "
        elif localhour >=12 and localhour <18:
            hello = "下午好， "
        else:
            hello = "晚上好， "
        self.setWindowTitle(_translate("Run", "大众点评免费试"))
        self.btnRun.setText(_translate("Run", "Run"))
        self.contentOpt.setHtml(_translate("Run", 
        "<p align=\"center\"><span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:11pt; color:#999999;\">收藏数：</span>"
        "<span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:12pt bold; color:#222222; text-decoration: underline;\">" + str(self.favorShopCount) + "</span>"
        "<span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:11pt; color:#999999;\">&nbsp;&nbsp;&nbsp;团购券：</span>"
        "<span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:12pt bold; color:#222222; text-decoration: underline;\">" + str(self.dealCount) + "</span></p>"))
        self.contentUseday.setHtml(_translate("Run", 
        "<p align=\"center\"><span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:11pt; color:#999999; background-color:#ffffff; vertical-align:middle;\">您已使用大众点评</span>"
        "<span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:12pt; color:#ff6633; background-color:#ffffff; vertical-align:middle;\">" + str(self.useDpDays) + "</span>"
        "<span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:11pt; color:#999999; background-color:#ffffff; vertical-align:middle;\">天</span></p>"))
        self.contentUser.setHtml(_translate("Run", 
        "<p align=\"right\"><span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:11pt; color:#333333; background-color:#ffffff; vertical-align:middle;\">" + hello + "</span>"
        "<span style=\" font-family:\'PingFangSC-Regular\',\'Microsoft YaHei\',\'Hiragino Sans GB\',\'Helvetica\'; font-size:11pt; text-decoration: underline; color:#333333; background-color:#ffffff; vertical-align:middle;\">" + self.userNickName + "</span></p>"))
        self.contentProvince.setHtml(_translate("Run", 
        "<p align=\"right\"><span style=\" font-size:11pt;\">请选择省份：</span></p>"))
        self.contentCity.setHtml(_translate("Run", 
        "<p align=\"right\"><span style=\" font-size:11pt;\">请选择城市：</span></p>"))

    def hideEvent(self, event):
        '''
        hideEvent()重写
        @ 最小化——>最小化至托盘
        '''
        self.setWindowFlags(QtCore.Qt.SplashScreen | QtCore.Qt.FramelessWindowHint)
    
    def closeEvent(self, event):
        '''
        closeEvent()重写
        @ 关闭——>关闭提示
        '''
        reply = QtWidgets.QMessageBox.question(self, '提示', '你怎么忍心关掉我鸭？', QtWidgets.QMessageBox.Yes | QtWidgets.QMessageBox.No, QtWidgets.QMessageBox.No)
        if reply == QtWidgets.QMessageBox.Yes:
            event.accept()
        else:
            event.ignore()

class TrayIcon(QtWidgets.QSystemTrayIcon):
    '''
    托盘图标以及托盘菜单
    '''
    def __init__(self, cookie):
        super().__init__()
        self.createTaskbarMenu()
        self.BaWangCan = Ui_Run(cookie, Province, City)
        self.BaWangCan.setupUi()

    def createTaskbarMenu(self):
        '''
        创建托盘图标与功能
        '''
        ico = 'https://www.dpfile.com/app/pc-common/dp_favicon.a4af753914321c8e82e402e2b4be01d7.ico'
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap(Ui_Login.getImgFromInternet(ico)['img']), QtGui.QIcon.Normal, QtGui.QIcon.Off)
        self.setIcon(icon)    # 设置托盘图标
        self.menu = QtWidgets.QMenu()
        self.showMenu = QtWidgets.QAction("显示/隐藏", self, triggered=self.on_showMenu_clicked)    # 定义菜单名称以及关联事件
        self.quitMenu = QtWidgets.QAction("退出     ", self, triggered=self.on_quitMenu_clicked)
        self.menu.addAction(self.showMenu)
        self.menu.addAction(self.quitMenu)
        self.setContextMenu(self.menu)    # 设置托盘菜单栏
        self.activated.connect(self.on_Icon_clicked)    # 关联鼠标点击事件
        self.show()

    def on_showMenu_clicked(self):
        '''
        显示/隐藏窗口事件
        '''
        if self.BaWangCan.isMinimized() or not self.BaWangCan.isVisible():
            self.BaWangCan.setWindowFlags(QtCore.Qt.Window)
            self.BaWangCan.activateWindow()
            self.BaWangCan.showNormal()
        else:
            self.BaWangCan.showMinimized()

    def on_quitMenu_clicked(self):
        '''
        退出窗口事件
        '''
        app.quit()

    def on_Icon_clicked(self, reason):
        '''
        鼠标点击信号：
            1：右键单击
            2：左键双击
            3：左键单击
            4：滚轮单击
        '''
        if reason == 3 or reason == 4:
            if self.BaWangCan.isMinimized() or not self.BaWangCan.isVisible():
                self.BaWangCan.setWindowFlags(QtCore.Qt.Window)
                self.BaWangCan.activateWindow()
                self.BaWangCan.showNormal()
            else:
                self.BaWangCan.showMinimized()

if __name__ == '__main__':
    Cookie = Config().getConfig('Cookie', 'Cookie')
    Province = Config().getConfig('Province', 'Province')
    City = Config().getConfig('City', 'City')
    # 创建应用程序
    app = QtWidgets.QApplication(sys.argv)
    valid = Ui_Run(Cookie).getUserinfo()
    if valid:
        UI = TrayIcon(Cookie)
    else:
        UI = Ui_Login()
    sys.exit(app.exec_())    # 程序执行循环